<% provide(:page_title, @user.username) %>

<div class="row">
  <div class="col-md-8 col-md-offset-2">
    <div class="well" id="profile">
      <h1>
        <%= gravatar_for(@user, size: 55) %>
        <%= @user.username %>
        <small> | <%= @user.score %></small>
      </h1>

      <% if current_user?(@user) %>
        <div class="user_stats center">
          <span>
            <button class="btn dropdown-toggle">
              <%= link_to "Messages", user_messages_path(@user) %>
              <% if @user.received_messages.unread.empty? %>
                <span class="ion-email"></span>
              <% else %>
                <span class="badge"><%= @user.received_messages.unread.size %></span>
              <% end %>
            </button>
          </span>
          <span>
            <%= render "profile_stats" %>
          </span>
          <span>
            <button class="btn dropdown-toggle">
              <%= link_to "Settings", edit_user_path(@user) %> <span class="ion-gear-a"></span>
            </button>
          </span>
        </div>
      <% end %>
      
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h2 class="center">Answered thoughts and responses</h2>
          <% if @public_posts.each do |post| %>
            <% if post.user == @user %>
              <div class="panel-focus panel-post">
                <% if post.responses.unrated.any? && current_user?(@user) %>
                  <span class="badge pull-right"><%= unrated_count(post) %></span>
                <% end %>
                <%= render partial: 'posts/index_post', object: post %>
              </div>
            <% end %>
        
            <% post.responses.descending.each do |response| %>
              <% if response.user == @user %>
                <div class="thought_wrapper">
                  <div class="panel-focus panel-response">
                    <% if response.ratings.any? && current_user?(@user) %>
                      <span class="badge pull-right"><%= average_rating(response) %></span>
                    <% end %>
                    <%= render partial: 'shared/thought', object: response, locals: { profile: true } %>
                  </div>
                </div>
              <% end %>
            <% end %>
          <% end.empty? %>
            <h3 class="center lighter">There are no answered thoughts or responses</h3>
          <% end %>
          <%= will_paginate @public_posts %>

          <% if current_user?(@user) %>
            <div class="personal_posts">
              <h2 class="center">Unanswered thoughts</h2>
              <% if @personal_posts.each do |post| %>
                <div class="thought_wrapper">
                  <div class="panel-lighter">
                    <%= render partial: 'shared/thought', object: post, locals: { profile: true } %>
                  </div>
                </div>
              <% end.empty? %>
                <h3 class="center lighter">There are no unanswered thoughts</h3>
              <% end %>
              <%= will_paginate @personal_posts %>  
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
